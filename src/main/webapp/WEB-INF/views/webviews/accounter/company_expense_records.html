<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>上海元升财务咨询有限公司</title>
    <link rel="stylesheet" type="text/css" href="/css/webcss/bui.css">
	<link rel="stylesheet" type="text/css" href="/css/webcss/golbal.css">
	<link rel="stylesheet" type="text/css" href="/css/webcss/layout.css">
</head>
<body>
	<div class="wrap">
		<div class="side-bar">
			<div class="side-bar-top">
				<img src="/img/webimg/bss-logo.png" >
				<h1>上海元升财务咨询有限公司</h1>
			</div>
            <div class="side-bar-content" id="menuTree"></div>
			<div class="side-bar-bottom">
				<ul>
					<li><a href=""><i class="setting"></i>设置</a></li>
					<li><a href="/logout"><i class="exit"></i>安全退出</a></li>
				</ul>
			</div>
		</div>
		<div class="main">
			<div class="menu"><a href="#" class="active">公司费用记录</a></div>
			<div class="well mt20">
				<div class="form-horizontal onlineTools">
					<div class="row show-grid">
						<label class="control-label control-label-small"></label>
                        <div class="controls"><select name="condition" id="condition" class="input input-normal"><option value='0'>所有</option><option value='1'>按公司名称检索</option></select><input type="text" id="content" class="input input-normal ml10"><button id="searchData" class="button button-success ml10">搜索</button></div>
					</div>
				</div>
			</div>
			<div id="currentTips" class="tips tips-warning" style="display: none;"></div>
			<table class="table center">
	    		<colgroup>
	    			<col style="width:25%;">
	    			<col style="width:25%;">
	    			<col style="width:25%;">
	    			<col style="width:25%;">
	    		</colgroup>
	    		<thead id="records">
	    			<tr>
	    				<th>公司名称</th>
	    				<th>日期</th>
	    				<th>类型</th>
	    				<th>金额</th>
	    			</tr>
	    		</thead>
	    		<tbody id='retData'>
	    		</tbody>
	    	</table>
	    	<div class="pagination"></div>
	    	<form action="/accounter/downloadCompanyExpense" id="downloadForm" method="POST">
        		<input type="hidden" id="fileName" name="fileName">
			</form>
		</div>
	</div>
	
<!--该js需要修改js路径及修改seajs路径-->
<script src="/js/webjs/jquery-1.11.1.js"></script>
<script src="http://g.alicdn.com/bui/seajs/2.3.0/sea.js"></script>
<script src="http://g.alicdn.com/bui/bui/1.1.17/config.js"></script>
<script src="/js/webjs/menuTree.js"></script>
<script type="text/javascript">
	BUI.use(['bui/imgview', 'bui/overlay'], function(Imgview, Overlay){
		function createDataList(data) {
			$('#retData').html("");
			if(data == null || data == "") return;
			if(data.companyExpense.length > 0 || data.companyInvoice.length > 0) {
				$('#records').show();
				$('#currentTips').hide();
			}
			var companyExpense = data.companyExpense;
			var container = $('#retData');
			for(var i=0; i<companyExpense.length; i++) {
			    var a = $("<tr><td>"+companyExpense[i].companyName+"</td><td>"+companyExpense[i].date+"</td><td>公司相关费用</td><td><a href='javascript:void(0);'>点击下载后查看</a></td></tr>");
			    var filesrc = companyExpense[i].file;
			    a.attr("file-src", filesrc);
			    a.click(function(event) {
			    	$('#fileName').val($(this).attr("file-src"));
			    	$('#downloadForm').submit();
			    });
			    a.appendTo(container);
			}
			var companyInvoice = data.companyInvoice;
			for(var i=0; i<companyInvoice.length; i++) {
			    var a = $("<tr><td>"+companyInvoice[i].companyName+"</td><td>"+companyInvoice[i].date+"</td><td>个人发票</td><td>"+companyInvoice[i].amount+"</td></tr>");
			    a.appendTo(container);
			}
		};
		$.ajax({
			url : '/accounter/accounterHasFinishRegister',
			type : "POST",
			data : {},
			success : function(data) {
				if(data != null && data.hasFinishRegister == 'false') {
					$('#currentTips').html('您还没有完成信息的详细注册，公司无法查看到您的信息，请先在完善注册信息菜单中完善您的个人信息！');
					$('#currentTips').show();
				} else {
					$.ajax({
						url : '/accounter/accounterHasBelongToCompany',
						type : "POST",
						data : {},
						success : function(data) {
							if(data != null && data.hasBind == 'false') {
								$('#currentTips').html('当前还没有任何公司选中您，因此没有相关数据可以查看！');
								$('#currentTips').show();
							} else {
								$.ajax({
									url : '/accounter/getAllCompanyExpense',
									type : "POST",
									data : {},
									success : function(data) {
										createDataList(data);
									}
								});
							}
						}
					});
				}
			}
		});
		$('#searchData').click(function(){
			var conditionType = $('#condition option:selected').val();
			var conditionValue = $('#content').val();
			if(conditionType != '0' && (conditionValue == null || conditionValue == '')) {
				BUI.Message.Alert('请输入需要检索内容的内容！','warning');
				return;
			}
			return;
			if(conditionType == '0') {
				$.ajax({
					url : '/accounter/getAllCompanyExpense',
					type : "POST",
					data : {},
					success : function(data) {
						createDataList(data);
					}
				});
			} else {
				$.ajax({
					url : '/accounter/getCompanyExpenseByCompanyName',
					type : "POST",
					data : {companyName:conditionValue},
					success : function(data) {
						createDataList(data);
					}
				});
			}
		})
	});
	//侧栏高度
    (function(){
        var H=$(window).height();
        var h1=$(".side-bar-top").height()+$(".side-bar-bottom").height();
        $(".side-bar-content").height(H-h1);
        $(window).resize(function(){
            H=$(window).height();
            $(".side-bar-content").height(H-h1);
        });
    })()
	//竖状菜单
	//竖状菜单
        var menu = new menuTree(
            {"nodes" : [
					{text : '公司费用信息',id : '10',href:"/views/webviews/accounter/company_expense_records.html", leaf:false, expanded : false,children: []},
					{text : '完善注册信息',id : '20',href:"/views/webviews/accounter/finish_reg_info.html",  leaf:false, expanded : false,children: []}
					]
            },"menuTree"
        );
    defaultSelect("10");
    function defaultSelect(id){ 
        $("#"+id).parent().addClass("bui-menu-item-selected")
    }
</script>
</body>
</html>