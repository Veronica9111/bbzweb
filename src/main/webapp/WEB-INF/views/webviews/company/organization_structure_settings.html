<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>上海青智财务咨询有限公司</title>
<link rel="stylesheet" type="text/css" href="/css/webcss/bui.css">
<link rel="stylesheet" type="text/css" href="/css/webcss/golbal.css">
<link rel="stylesheet" type="text/css" href="/css/webcss/layout.css">
<link rel="stylesheet" type="text/css" href="/css/webcss/zTreeStyle.css">
<style type="text/css">
.ztree li span.button.add {
	margin-left: 2px;
	margin-right: -1px;
	background-position: -144px 0;
	vertical-align: top;
	*vertical-align: middle
}
</style>
</head>
<body>
	<div class="wrap">
		<div class="side-bar">
			<div class="side-bar-top">
				<img src="/img/webimg/bss-logo.png">
				<h1>上海青智财务咨询有限公司</h1>
			</div>
			<div class="side-bar-content"></div>
			<div class="side-bar-bottom">
				<ul>
					<li><a href=""><i class="setting"></i>设置</a></li>
					<li><a href="/logout"><i class="exit"></i>安全退出</a></li>
				</ul>
			</div>
		</div>
		<div class="main">
			<div class="framework">
				<table class="table table-bordered">
					<colgroup>
						<col style="width: 220px; background: #fafafa; overflow: hidden;">
						<col>
					</colgroup>
					<tr>
						<td>
							<div class="fk-tree">
								<h2>组织架构</h2>
								<ul id="t1" class="ztree"></ul>
							</div>
						</td>
						<td>
							<div class="fk-content">
								<div class="menu">
									<a href="" class="active">当前组织架构信息</a>
								</div>
								<div class="fk-content-info">
									<div class="form-horizontal onlineTools">
										<div class="row-fluid show-grid">
											<div class="span12">
												<label>公司名称：</label><span id="company_name"
													class="detail-text"></span>
											</div>
											<div class="span12">
												<label>上级组织：</label><span id="parent_company"
													class="detail-text"></span>
											</div>
										</div>
										<div class="row-fluid show-grid">
											<div class="span12">
												<label>组织名称：</label><span id="org_name" class="detail-text"></span>
											</div>
											<div class="span12">
												<label>组织代码：</label><span id="org_code" class="detail-text"></span>
											</div>
										</div>
										<div class="row-fluid show-grid">
											<div class="span12">
												<label>组织类型：</label><span id="org_type" class="detail-text"></span>
											</div>
										</div>
									</div>
									<div class="panel mt10">
										<div class="panel-header"
											style="color: #5da09a; font-weight: bold; font-size: 14px;">当前可以进行的操作</div>
										<div class="panel-body well" style="height: 150px;">
											<div id="addOneLevelDeptOrSubCompany" style="display: none;">
												<div>
													<label for="">您可以添加一级部门：</label> <select
														class="input input-normal" id="oneLevelDeptSelect"
														style="width: 160px;"></select>
													<button id="addNewOneLevelDept"
														class="button button-success ml10">确定添加</button>
												</div>
												<div>
													<p class="mt10">
														<label for="">您可以添加子公司：</label><input type="text"
															id="newSubCompanyName" class="input input-normal"
															style="margin-left: 15px;">
														<button id="addNewSubComapny"
															class="button button-success ml10">确定添加</button>
													</p>
												</div>
											</div>
											<div id="addSubDept" style="display: none;">
												<p>
													您当前选择的是：<b class="text-danger mr20" id="currentSelectDept"></b><a
														href="javascript:void(0);" id="modifyDeptName">修改部门名称</a><a
														href="javascript:void(0);" id="deleteDept">删除该部门</a>
												</p>
												<p class="mt10">
													<label for="">您可以增加子部门：</label><input id="newDeptName"
														type="text" class="input input-normal">
													<button id="addNewDept" class="button button-success ml10">确定添加</button>
												</p>
											</div>
											<div style="margin-top: 20px;">
												<div id="currentOpeTips" class="tips tips-warning"
													style="display: none;"></div>
												<div id="currentTips" class="tips tips-success"
													style="display: none;"></div>
											</div>
										</div>
									</div>
								</div>

							</div>
						</td>
					</tr>
				</table>
			</div>
			<div class="panel mt20">
				<div class="panel-header">
					组织成员
					<button id="addDeptUser"
						class="fr mtt5 button button-success button-small disabled">添加员工</button>
				</div>
				<div class="panel-body" style="min-height: 300px;">
					<table class="table table-bordered table-head-bordered center">
						<colgroup>
							<col style="width: 19%;">
							<col style="width: 19%;">
							<col style="width: 19%;">
							<col style="width: 19%;">
							<col>
						</colgroup>
						<thead>
							<tr>
								<th>员工姓名</th>
								<th>所在部门</th>
								<th>员工编号</th>
								<th>员工职级</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>李萌萌</td>
								<td>客服部</td>
								<td>6001</td>
								<td>客服经理<span class="highlight">负责人</span></td>
								<td><span class="text-primary btnShow">修改</span><a href="">删除</a></td>
							</tr>
							<tr>
								<td>李萌萌</td>
								<td>客服部</td>
								<td>6001</td>
								<td>客服经理</td>
								<td><a href="">修改</a><a href="">删除</a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<div id="addDeptUserForm" class="hide">
		<div id="form" class="form-horizontal">
			<div class="control-group">
				<label class="control-label"><s>*</s>电子邮件地址：</label>
				<div class="controls">
					<input id="dept_user_email" type="text" class="input-large"
						data-rules="{required : true}" style="width:250px;">
					<span class="ml10 text-danger">已被使用，请检查！</span>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><s>*</s>员工姓名：</label>
				<div class="controls">
					<input type="text" class="input-large" id="dept_user_name"
						data-rules="{required : true}" style="width:250px;">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><s>*</s>负责人标示：</label>
				<div class="controls control-row-auto">
					<select class="input input-normal" id="dept_user_is_admin" style="width: 260px;">
						<option value='0'>非部门负责人</option>
						<option value='1'>部门负责人</option>
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">所在部门：</label>
				<div class="controls">
					<input type="text" class="input-large" id="dept_user_dept_name"
						data-rules="{required : true}" disabled style="width:250px;">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><s>*</s>员工编号：</label>
				<div class="controls control-row-auto">
					<input type="text" id="dept_user_code" class="input-large" style="width:250px;"></input>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><s>*</s>员工职级：</label>
				<div class="controls control-row-auto">
					<input type="text" id="dept_user_level" class="input-large" style="width:250px;"></input>
				</div>
			</div>
			<div class="control-group control-btn">
				<div class="layer-wrap-footer"><a href="javascript:void(0);" id="dept_user_submit" class="button button-success">确定添加</a></div>
			</div>
		</div>
	</div>

	<!--该js需要修改js路径及修改seajs路径-->
	<script src="http://g.tbcdn.cn/fi/bui/jquery-1.8.1.min.js"></script>
	<script src="http://g.alicdn.com/bui/seajs/2.3.0/sea.js"></script>
	<script src="http://g.alicdn.com/bui/bui/1.1.17/config.js"></script>
	<!--ztree-->
	<!-- <script src="/js/webjs/zTree_v3/jquery.ztree.all-3.5.min.js"></script> -->
	<script type="text/javascript">
	//竖状菜单
    BUI.use('bui/tree',function (Tree) {
        var menu = new Tree.TreeMenu({
        render : '.side-bar-content',

        elCls : 'bui-side-menu', 
        itemCls : 'bui-menu-item',
        expandAnimate : true,
        showIcons : true,
        loadMask:true,

        dirTpl : '<li class="menu-leaf menu-second"><div class="bui-menu-title"><s></s><span class="bui-menu-title-text"><a href="{href}">{text}</a></span></div></li>',
        leafTpl : '<li class="menu-leaf"><a href="{href}">{text}</a></li>',

        nodes : [
					{text : '公司发票',id : '10',href:"javascript:void(0);",  expanded : true,children: [
						{text : '发票上传',id : '11', href:"/views/webviews/company/expense_account_upload.html"},
                     {text : '发票历史记录',id : '12', href:"/views/webviews/company/expense_account_history.html"}                                           
                 ]},
                 {text : '银行对账单',id : '20',href:"javascript:void(0);", expanded : false,children: [
						{text : '上传对账单',id : '21', href:"/views/webviews/company/bank_statement_upload.html"},
						{text : '对账单历史记录',id : '22', href:"/views/webviews/company/bank_statement_history.html"}                                           
					]},
					 {text : '工资社保',id : '30',href:"javascript:void(0);", expanded : false,children: [
						{text : '参数设置',id : '31', href:"/views/webviews/company/salary_welfare_args_settings.html"},
						{text : '下载工资计算模板',id : '32', href:"/views/webviews/company/salary_welfare_template_download.html"},                                           
						{text : '上传本月工资',id : '33', href:"/views/webviews/company/salary_welfare_upload.html"}
					]},
					{text : '预约取发票',id : '40',href:"javascript:void(0);", expanded : false,children: [
						{text : '方式选择',id : '41', href:"/views/webviews/company/take_expense_account_mode_select.html"}                                           
					]},
					{text : '组织架构',id : '50',href:"javascript:void(0);",  expanded : false,children: [
						{text : '基本信息设置',id : '51', href:"/views/webviews/company/organization_information_settings.html"},
						{text : '组织架构设置',id : '52', href:"/views/webviews/company/organization_structure_settings.html"}                                           
					]},
         ]
    	});
   		menu.render();
        $.each($("li.menu-second"),function(){
            var that = $(this);
            if(that.next().hasClass("menu-second")){
                that.find("s").remove();
            }
        })
        menu.on('itemclick',function(ev){
            $('.log').text(ev.item.text);
        });
        var firstLeaf = menu.findNode('11'); //获取第一个叶子节点
        menu.setSelected(firstLeaf);
    });
	
	
	
    BUI.use(['bui/tree','bui/data','bui/overlay'],function (Tree,Data,Overlay) {
    	$('#addNewOneLevelDept').click(function(){
    		var oneLevelDeptSelectCostCenterEncode = $('#oneLevelDeptSelect option:selected').val();
    		var oneLevelDeptSelectName = $('#oneLevelDeptSelect option:selected').text();
    		var item = tree.getSelected();
    		var companyId = (item == null || item=='' ? headCompanyId : item.companyId);
    		$.ajax({
        		url : '/company/addDept',
        		type : "POST",
        		data : {deptName:oneLevelDeptSelectName,curDeptId:0,level:0,companyId:companyId},
        		success : function(data) {
        			if(data == null || data == '' || data.resultCode == null || data.resultCode != '0') {
        				alert('出错');
        				return;
        			} else {
        				store.load(null);
        			}        			
        		}
        	});
    	})
    	$('#addNewSubComapny').click(function(){
    		var newSubCompanyName = $('#newSubCompanyName').val();
    		$.ajax({
        		url : '/company/addSubCompany',
        		type : "POST",
        		data : {companyName:newSubCompanyName,curCompanyId:headCompanyId},
        		success : function(data) {
        			if(data == null || data == '' || data.resultCode == null || data.resultCode != '0') {
        				//alert('出错');
        				return;
        			} else {
        				store.load(null);
        			}        			
        		}
        	});
    	})
    	$('#addNewDept').click(function(){
    		alert(3);
    	})
    	$('#modifyDeptName').click(function(){
    		alert(4);
    	})
    	$('#deleteDept').click(function(){
    		alert(5);
    	})
    	$('#addDeptUser').click(function(){
    		//dialogForm
            var dialogForm = new Overlay.Dialog({
                title:'添加部门员工',
                width:600,
                contentId:'addDeptUserForm',
                success:function () {
	              	alert('确认');
	              	this.close();
	            },
                buttons : []
            });
            dialogForm.show();
    	})
    	var hasSetCompanyDetailInfo = false;
    	var headCompanyName = '';
    	var headCompanyId = '';
    	var currentSelectOrg = '';
    	var notSetDetailInfoTips = '您当前还没有设置总共司的详细信息，不可以进行任何操作，<a href="/views/webviews/company/organization_information_settings.html">点击这里进行设置<a>'
    	$.ajax({
    		url : '/company/getAllCostCenterEncode',
    		type : "POST",
    		async: false,
    		data : {},
    		success : function(data) {
    			if(data == null || data == '') return;
    			for(var i=0; i<data.length; i++) {
    				$('#oneLevelDeptSelect').append("<option value='"+data[i].encode+"'>"+data[i].name+"("+data[i].alias+")</option>");
    			}
    		}
    	});
    	$.ajax({
    		url : '/company/getCompanyDetailInfo',
    		type : "POST",
    		data : {},
    		async: false,
    		success : function(data) {
    			if(data == null || data == '') {
    				$('#currentOpeTips').html(notSetDetailInfoTips);
    				$('#currentOpeTips').show();
    				return;
    			}
    			$('#currentOpeTips').hide();
    			hasSetCompanyDetailInfo = true;
    			$('#company_name').html(data.company_name);
    			headCompanyName = data.company_name;
    			headCompanyId = data.company_id;
    			currentSelectOrg = headCompanyId;
    			$('#parent_company').html(data.parent_company_name == null || data.parent_company_name == '' ? '无' : data.parent_company_name);
    			$('#org_name').html(data.company_name);
    			$('#org_code').html(data.org_code);
    			$('#org_type').html('总公司');
    			$('#addOneLevelDeptOrSubCompany').show();	
    		}
    	});
    	//数据缓冲类
        var store = new Data.TreeStore({
            root : {
              id : headCompanyId,
              text : headCompanyName
            },
            url : '/company/getOrgStructureData',
            autoLoad : true
          });
          
        var tree = new Tree.TreeList({
          render : '#t1',
          showLine : true,
          height:300,
          store : store,
          showRoot : true
        });
        tree.render();
        var item = tree.getItem(headCompanyId);
        tree.setSelected(item);
        tree.on('itemclick',function(ev){
        	currentSelectOrg = ev.item.id;
        	if(ev.item.typeIsDept) {
        		$('#addDeptUser').removeClass('disabled');
        		$('#addOneLevelDeptOrSubCompany').hide();
        		$('#addSubDept').show();
        		$('#currentSelectDept').html(ev.item.text);
        	} else {
        		$('#addDeptUser').addClass('disabled');
        		$('#addOneLevelDeptOrSubCompany').show();
        		$('#addSubDept').hide();
        	}
        	if(ev.item.typeIsSubCompany) {
        		$('#company_name').html(ev.item.text);
        		$('#parent_company').html(headCompanyName);
        		$('#org_type').html('分公司');
        		$('#org_name').html(ev.item.text);
        	} else {
        		$('#company_name').html(headCompanyName);
        		$('#org_name').html(ev.item.text);
        		$('#parent_company').html('无');
        		$('#org_type').html('总公司');
        	}
        	//alert(node);
        	//var subNode = store.add({id : '205',text: '测试部门'}, node);
        	//tree.render();
          	//var item = ev.item;
          	//$('.log').text(item.text);
        });
      });
	</script>
</body>
</html>